C51 COMPILER V9.57.0.0   MAIN                                                              10/02/2024 10:01:27 PAGE 1   


C51 COMPILER V9.57.0.0, COMPILATION OF MODULE MAIN
OBJECT MODULE PLACED IN .\Objects\main.obj
COMPILER INVOKED BY: D:\Software\WorkSoftware\Keil5\C51\C51\BIN\C51.EXE User\main.c OPTIMIZE(8,SPEED) BROWSE INCDIR(.\Us
                    -er;.\Hardware;.\Startup;.\Readme) DEBUG OBJECTEXTEND PRINT(.\Listings\main.lst) TABS(2) OBJECT(.\Objects\main.obj)

line level    source

   1          /*
   2          
   3          Version: 1.0.1
   4          Check out the Readme.txt for more details 
   5           
   6          */
   7           
   8          //ÏµÍ³¿â
   9          #include "main.h"
  10          #include <stdio.h>
  11          
  12          //ÍâÉè¿â
  13          #include "gpio.h"
  14          #include "timer.h"
  15          #include "key.h"
  16          #include "seg.h"
  17          #include "uart.h"
  18          //#include "eeprom.h"
  19          #include "config.h"
  20          
  21          //-----------¹¦ÄÜÑ¡ÔñÇø-----------
  22          
  23          
  24          //³ÌÐòÖ´ÐÐº¯Êý
  25          void Key_Proc(void);       //Keystroke process function
  26          void Disp_Proc(void);      //LCD Dsiplay process function
  27          
  28          //×Ô¶¨Òå¹¦ÄÜº¯Êý
  29          void Delay(unsigned int delay); //¶¨Ê±Æ÷ÑÓÊ± »á¿¨×¡µ±Ç°º¯Êý£¬µ«²»»áÓ°ÏìÕû¸ö´úÂë
  30          void Peripheral_Init(void);//ÍâÉè³õÊ¼»¯º¯Êý
  31          
  32          void UART2_config(u8 brt);   // ï¿?0ï¿?5ï¿?1ï¿?7ï¿?1ï¿?7ï¿?1ï¿?7ï¿?1ï¿?7ï¿?1ï¿?7ï¿?1ï¿?7, 2: ï¿?0ï¿?0ï¿?1ï
             -¿?7ï¿?1ï¿?7Timer2ï¿?1ï¿?7ï¿?1ï¿?7ï¿?1ï¿?7ï¿?1ï¿?7ï¿?1ï¿?7ï¿?1ï¿?7ï¿?1ï¿?7ï¿?1ï¿?7, ï¿?1ï¿?7ï¿?1ï¿?7ï¿?1ï¿?7ï¿?1ï¿?7ï¿?0ï
             -¿?5: ï¿?1ï¿?7ï¿?1ï¿?7å®?.
  33          void PrintString2(u8 *puts);
  34          
  35          //----------------ï¿?1ï¿?7ï¿?1ï¿?7ï¿?1ï¿?7ï¿?1ï¿?7ï¿?1ï¿?7ï¿?1ï¿?7ï¿?0ï¿?8ï¿?1ï¿?7ï¿?1ï¿?0ï¿?0ï¿?7ï¿?0ï¿?3
             -ï¿?1ï¿?7ï¿?1ï¿?7ï¿?1ï¿?7-------------------------------------
  36          
  37          //ï¿?0ï¿?6ï¿?1ï¿?7ï¿?0ï¿?4ï¿?1ï¿?7ï¿?1ï¿?7ï¿?1ï¿?7,ï¿?1ï¿?7ï¿?1ï¿?7ï¿?1ï¿?7ï¿?1ï¿?710msï¿?0ï¿?9ï¿?1ï¿?7ï¿?
             -1ï¿?7ï¿?0ï¿?5ï¿?1ï¿?7ï¿?1ï¿?7,ï¿?1ï¿?7ï¿?1ï¿?7ï¿?1ï¿?7ï¿?1ï¿?7ï¿?1ï¿?7200msï¿?0ï¿?6ï¿?1ï¿?7ï¿?1ï¿?7ï¿?0ï¿?5ï¿?1ï¿?7ï¿?1ï
             -¿?7
  38          u16 key_slow_down = 0; //ï¿?1ï¿?7ï¿?1ï¿?7ï¿?1ï¿?7ï¿?1ï¿?7ï¿?0ï¿?6ï¿?1ï¿?7ï¿?0ï¿?4ï¿?1ï¿?7ï¿?1ï¿?7ï¿?1ï¿?7
  39          u16 disp_slow_down = 0; //ï¿?1ï¿?7ï¿?1ï¿?7ï¿?0ï¿?5ï¿?0ï¿?6ï¿?1ï¿?7ï¿?0ï¿?4ï¿?1ï¿?7ï¿?1ï¿?7ï¿?1ï¿?7
  40          
  41          /*ï¿?1ï¿?7ï¿?1ï¿?7ï¿?1ï¿?7ï¿?1ï¿?7ï¿?1ï¿?7ï¿?1ï¿?7ï¿?1ï¿?9ï¿?1ï¿?7ï¿?1ï¿?7ï¿?1ï¿?7*/
  42          u16 key_tick;        //long key press count
  43          bit key_sw = 1;
  44          bit keylong = 1;
  45          
  46          u8 key_value = 0;       //ï¿?1ï¿?7ï¿?1ï¿?7ï¿?1ï¿?7ï¿?1ï¿?7ï¿?0ï¿?5
  47          u8 key_down;            //ï¿?1ï¿?7ï¿?1ï¿?7ï¿?1ï¿?7ï¿?1ï¿?7ï¿?1ï¿?7ï¿?0ï¿?5ï¿?1ï¿?7ï¿?1ï¿?7ï¿?1ï¿?7
  48          u8 key_up;              //ï¿?1ï¿?7ï¿?1ï¿?7ï¿?1ï¿?7ï¿?1ï¿?7ï¿?1ï¿?7ï¿?1ï¿?7
  49          u8 key_old;             //ï¿?1ï¿?7ï¿?0ï¿?2æ±ï¿½0ï¿?2ï¿?1ï¿?7ï¿?1ï¿?7ï¿?1ï¿?7ï¿?0ï¿?5
C51 COMPILER V9.57.0.0   MAIN                                                              10/02/2024 10:01:27 PAGE 2   

  50          
  51          u16 delay_tick;         //ï¿?1ï¿?7ï¿?1ï¿?7ï¿?1ï¿?7ï¿?1ï¿?7ï¿?1ï¿?7ï¿?1ï¿?7ï¿?0ï¿?2ï¿?1ï¿?7ï¿?1ï¿?7ï¿?1ï¿?7
             -ï¿?1ï¿?7
  52          
  53          /*ï¿?1ï¿?7ï¿?1ï¿?7ï¿?1ï¿?7ï¿?1ï¿?7ï¿?1ï¿?7ï¿?1ï¿?7ï¿?1ï¿?7ï¿?0ï¿?5ï¿?1ï¿?7ï¿?1ï¿?7ï¿?1ï¿?9ï¿?1ï¿?7ï¿?1ï¿?7
             -ï¿?1ï¿?7*/
  54          char seg_string[4];     //ï¿?1ï¿?7ï¿?1ï¿?7ï¿?1ï¿?7ï¿?1ï¿?7ï¿?1ï¿?7ï¿?1ï¿?7ï¿?1ï¿?7ï¿?0ï¿?5ï¿?1ï¿?7ï¿?0ï¿?7ï¿
             -?1ï¿?7ï¿?1ï¿?7ï¿?1ï¿?7
  55          char seg_buf1[4];       //ï¿?1ï¿?7ï¿?1ï¿?7ï¿?1ï¿?7ï¿?1ï¿?7ï¿?1ï¿?71ï¿?1ï¿?7ï¿?1ï¿?7ï¿?0ï¿?5ï¿?1ï¿?7ï¿?1ï¿?7ï¿
             -?1ï¿?7ï¿?1ï¿?7ï¿?1ï¿?7ï¿?1ï¿?7
  56          char seg_buf2[4];       //ï¿?1ï¿?7ï¿?1ï¿?7ï¿?1ï¿?7ï¿?1ï¿?7ï¿?1ï¿?72ï¿?1ï¿?7ï¿?1ï¿?7ï¿?0ï¿?5ï¿?1ï¿?7ï¿?1ï¿?7ï¿
             -?1ï¿?7ï¿?1ï¿?7ï¿?1ï¿?7ï¿?1ï¿?7
  57          
  58          u8 LED_buf;           //ï¿?1ï¿?7ï¿?1ï¿?7ï¿?1ï¿?7ï¿?1ï¿?7ï¿?1ï¿?7ï¿?1ï¿?7LEDï¿?1ï¿?7ï¿?1ï¿?7ï¿?1ï¿?7ï¿?1ï¿?7 0b0
             -011 1111 1ï¿?0ï¿?2ï¿?1ï¿?7ï¿?1ï¿?7 0ï¿?0ï¿?2ï¿?1ï¿?7ï¿?1ï¿?7
  59          u8 pos = 0;             //ï¿?1ï¿?7ï¿?1ï¿?7ï¿?1ï¿?7ï¿?1ï¿?7ï¿?1ï¿?0ï¿?1ï¿?7ï¿?0ï¿?5
  60          
  61          /*ï¿?1ï¿?7ï¿?1ï¿?7ï¿?1ï¿?7ï¿?1ï¿?7ï¿?1ï¿?7ï¿?1ï¿?7ï¿?1ï¿?9ï¿?1ï¿?7ï¿?1ï¿?7ï¿?1ï¿?7*/
  62          u8  TX2_Cnt;    //ï¿?1ï¿?7ï¿?1ï¿?7ï¿?1ï¿?7ï¿?0ï¿?0ï¿?1ï¿?7ï¿?1ï¿?7ï¿?1ï¿?7
  63          u8  RX2_Cnt;    //ï¿?1ï¿?7ï¿?1ï¿?7ï¿?1ï¿?7ï¿?0ï¿?8ï¿?1ï¿?7ï¿?1ï¿?7ï¿?1ï¿?7
  64          bit B_TX2_Busy; //ï¿?1ï¿?7ï¿?1ï¿?7ï¿?1ï¿?7ï¿?1ï¿?7ï¿?0ï¿?3ï¿?1ï¿?7ï¿?1ï¿?7ï¿?0ï¿?4
  65          
  66          u8  xdata RX2_Buffer[UART2_BUF_LENGTH]; //ï¿?1ï¿?7ï¿?1ï¿?7ï¿?1ï¿?7ï¿?0ï¿?7ï¿?1ï¿?7ï¿?1ï¿?7ï¿?1ï¿?7
  67          
  68          /*ï¿?1ï¿?7ï¿?1ï¿?7ï¿?1ï¿?7ï¿?1ï¿?7ï¿?1ï¿?7ï¿?1ï¿?7ï¿?1ï¿?9ï¿?1ï¿?7ï¿?1ï¿?7ï¿?1ï¿?7*/
  69          u16 buzzer_tick;        //ï¿?1ï¿?7ï¿?1ï¿?7ï¿?1ï¿?7ï¿?1ï¿?7ï¿?1ï¿?7ï¿?1ï¿?7ï¿?1ï¿?7ï¿?1ï¿?7ï¿?1ï¿?7ï¿?1ï¿?7
             -ï¿?1ï¿?7ï¿?1ï¿?7ï¿?1ï¿?7
  70          
  71          /*ï¿?1ï¿?7ï¿?1ï¿?7ï¿?1ï¿?7ï¿?1ï¿?7ï¿?1ï¿?7ï¿?1ï¿?7ï¿?0ï¿?7ï¿?1ï¿?7ï¿?1ï¿?7ï¿?1ï¿?7*/
  72          u8 mode;                //ï¿?0ï¿?0ï¿?0ï¿?4ï¿?1ï¿?7æŠ–ï¿½1ï¿?7
  73          
  74          void main(){
  75   1        GPIO_Init();      //ï¿?1ï¿?7ï¿?1ï¿?7ï¿?1ï¿?7ï¿?0ï¿?5ï¿?1ï¿?7ï¿?0ï¿?3ï¿?1ï¿?7ï¿?1ï¿?
  76   1        Timer1_Init();    //ï¿?1ï¿?7ï¿?1ï¿?7ï¿?0ï¿?2ï¿?1ï¿?7ï¿?1ï¿?7ï¿?1ï¿?7ï¿?1ï¿?7ï¿?0ï¿?3ï¿?1ï¿?7ï¿?1ï¿?7
  77   1        UART2_config(2);  // ï¿?0ï¿?5ï¿?1ï¿?7ï¿?1ï¿?7ï¿?1ï¿?7ï¿?1ï¿?7ï¿?1ï¿?7ï¿?1ï¿?7, 2: ï¿?0ï¿?0ï¿?1ï¿?7ï¿?1ï¿?
             -7Timer2ï¿?1ï¿?7ï¿?1ï¿?7ï¿?1ï¿?7ï¿?1ï¿?7ï¿?1ï¿?7ï¿?1ï¿?7ï¿?1ï¿?7ï¿?1ï¿?7, ï¿?1ï¿?7ï¿?1ï¿?7ï¿?1ï¿?7ï¿?1ï¿?7ï¿?0ï¿?5: ï¿?1ï
             -¿?7ï¿?1ï¿?7å®?.
  78   1        EA = 1;           //ï¿?1ï¿?7ï¿?1ï¿?7ï¿?1ï¿?7ï¿?1ï¿?7ï¿?1ï¿?7å¿?ï¿?1ï¿?7
  79   1        Config_Init();    //ï¿?1ï¿?7ï¿?1ï¿?7ï¿?0ï¿?3ï¿?1ï¿?7ï¿?1ï¿?7ï¿?1ï¿?7ï¿?1ï¿?7ï¿?1ï¿?7ï¿?1ï¿?7
  80   1        Peripheral_Init();//ï¿?1ï¿?7ï¿?1ï¿?7ï¿?1ï¿?7Ð—ï¿?1ï¿?7ï¿?1ï¿?7ï¿?1ï¿?7ï¿?1ï¿?7ï¿?0ï¿?3ï¿?0ï¿?8ï¿?0ï¿?0
  81   1        
  82   1        PrintString2("STC8H8K64U UART2 Test Programme!\r\n");  //UART2ï¿?1ï¿?7ï¿?1ï¿?7ï¿?1ï¿?7ï¿?1ï¿?7ï¿?0ï¿?5ï¿?
             -1ï¿?7ï¿?1ï¿?7ï¿?1ï¿?7ï¿?0ï¿?7ï¿?1ï¿?7ï¿?1ï¿?7ï¿?1ï¿?7
  83   1        
  84   1        while(1)
  85   1        {
  86   2                  if((TX2_Cnt != RX2_Cnt) && (!B_TX2_Busy))   //ï¿?1ï¿?7ï¿?0ï¿?1ï¿?1ï¿?7ï¿?1ï¿?7ï¿?1ï¿?7ï¿?1ï¿?7ï¿
             -?1ï¿?7, ï¿?1ï¿?7ï¿?1ï¿?7ï¿?1ï¿?7ï¿?0ï¿?3ï¿?1ï¿?7ï¿?1ï¿?7ï¿?1ï¿?7
  87   2              {
  88   3                  S2BUF = RX2_Buffer[TX2_Cnt];
  89   3                  B_TX2_Busy = 1;
  90   3                  if(++TX2_Cnt >= UART2_BUF_LENGTH)   TX2_Cnt = 0;
  91   3              }
  92   2          
  93   2          
  94   2          Key_Proc();
  95   2          Disp_Proc();
  96   2          LED1 = 0;
  97   2          LED2 = 0;
  98   2          LED3 = 0;   
  99   2          
 100   2        }
C51 COMPILER V9.57.0.0   MAIN                                                              10/02/2024 10:01:27 PAGE 3   

 101   1      } 
 102          
 103          //================ï¿?1ï¿?7å¿?ï¿?0ï¿?8ï¿?1ï¿?7ï¿?1ï¿?7ï¿?1ï¿?7=======================
 104          void Timer1_Isr(void) interrupt 3   //1ms ï¿?1ï¿?7å¿?ï¿?1ï¿?7ï¿?0ï¿?5ï¿?1ï¿?7ï¿?1ï¿?7
 105          {
 106   1        //ï¿?1ï¿?7ï¿?1ï¿?7ï¿?1ï¿?7å¿?ï¿?0ï¿?8ï¿?1ï¿?7ï¿?1ï¿?7ï¿?1ï¿?7ï¿?1ï¿?7ï¿?1ï¿?7ï¿?0ï¿?0ï¿?1ï¿?7ï¿?0ï¿?0ï¿?1
             -ï¿?7ï¿?0ï¿?5ï¿?1ï¿?7ï¿?1ï¿?7ï¿?0ï¿?4ï¿?1ï¿?7ï¿?1ï¿?7ï¿?1ï¿?7ï¿?1ï¿?7ï¿?1ï¿?7ï¿?0ï¿?4ï¿?0ï¿?7ï¿?1ï¿?7ï¿?1ï¿?7ï¿?1ï¿?7å¿?ï
             -¿?1ï¿?7ï¿?0ï¿?2ï¿?1ï¿?7ï¿?4ï¿?6ï¿?1ï¿?7ï¿?1ï¿?7ï¿?1ï¿?7ï¿?1ï¿?7ï¿?1ï¿?7
 107   1        if(++key_slow_down == 10) key_slow_down = 0;   //10msï¿?0ï¿?9ï¿?1ï¿?7ï¿?1ï¿?7ï¿?0ï¿?5ï¿?1ï¿?7ï¿?0ï¿?8ï¿?1
             -ï¿?7ï¿?1ï¿?7ï¿?1ï¿?7
 108   1        if(++disp_slow_down == 200) disp_slow_down = 0;//200msï¿?0ï¿?6ï¿?1ï¿?7ï¿?1ï¿?7ï¿?0ï¿?5ï¿?1ï¿?7ï¿?1ï¿?7ï¿?
             -1ï¿?7ï¿?1ï¿?7ï¿?1ï¿?7ï¿?1ï¿?7ï¿?1ï¿?7
 109   1         
 110   1      //--------------------1sï¿?1ï¿?7ï¿?1ï¿?7ï¿?0ï¿?2ï¿?1ï¿?7ï¿?1ï¿?7---------------------------
 111   1        
 112   1      
 113   1      //--------------------ï¿?1ï¿?7ï¿?1ï¿?7ï¿?1ï¿?7ï¿?1ï¿?7ï¿?1ï¿?7ï¿?1ï¿?7ï¿?1ï¿?7---------------------------
 114   1        
 115   1        //ï¿?1ï¿?7ï¿?1ï¿?7ï¿?1ï¿?7ï¿?1ï¿?7ï¿?1ï¿?7ï¿?1ï¿?7ï¿?1ï¿?7ï¿?0ï¿?4ï¿?1ï¿?7ï¿?1ï¿?7ï¿?1ï¿?7ï¿?0ï¿?2
 116   1        if(key_tick > 0) key_tick--;  
 117   1          
 118   1        //ï¿?1ï¿?7ï¿?1ï¿?7ï¿?1ï¿?7ï¿?1ï¿?7ï¿?1ï¿?7ï¿?1ï¿?7ï¿?0ï¿?2
 119   1        if(delay_tick > 0) delay_tick--;//ï¿?1ï¿?7ï¿?1ï¿?7ï¿?0ï¿?2ï¿?1ï¿?7ï¿?1ï¿?7ï¿?1ï¿?7ï¿?1ï¿?7 ï¿?0ï¿?0ï¿?1ï¿
             -?7ï¿?0ï¿?4ï¿?6ï¿?2ï¿?0ï¿?9ï¿?1ï¿?7ï¿?1ï¿?7ï¿?0ï¿?2ï¿?1ï¿?7ï¿?1ï¿?7ï¿?1ï¿?7ï¿?1ï¿?7ï¿?1ï¿?7ï¿?1ï¿?7ï¿?1ï¿?7ï¿?1ï¿?7ï¿?1ï¿
             -?7ï¿?1ï¿?7ï¿?0ï¿?8ï¿?1ï¿?7ï¿?1ï¿?7ï¿?1ï¿?7ï¿?1ï¿?7ï¿?1ï¿?7ï¿?1ï¿?7ï¿?1ï¿?7ï¿?1ï¿?7ï¿?1ï¿?7ï¿?1ï¿?7
 120   1          
 121   1        //ï¿?1ï¿?7ï¿?1ï¿?7ï¿?1ï¿?7ï¿?1ï¿?7ï¿?1ï¿?0ï¿?1ï¿?7ï¿?0ï¿?5ï¿?0ï¿?6ï¿?1ï¿?7ï¿?1ï¿?7
 122   1      
 123   1        Seg_Disp1(seg_buf1,pos);
 124   1        Seg_Disp2(seg_buf2,pos);
 125   1        if(++pos > 3) pos = 0;
 126   1      }
 127          
 128          //================ï¿?1ï¿?7ï¿?1ï¿?7ï¿?1ï¿?7ï¿?1ï¿?7ï¿?1ï¿?7ï¿?1ï¿?8ï¿?1ï¿?7ï¿?1ï¿?7ï¿?1ï¿?7ï¿?1ï¿?7ï¿?1ï¿?7
             -=======================
 129          void Key_Proc(void)        //Keystroke process function
 130          {
 131   1        if(key_slow_down) return;   //10msï¿?1ï¿?7ï¿?1ï¿?7ï¿?1ï¿?7ï¿?1ï¿?7ï¿?0ï¿?5ï¿?1ï¿?7æ±›ï¿½0ï¿?0ï¿?1ï¿?7ï¿?1
             -ï¿?7ï¿?1ï¿?7
 132   1          key_slow_down = 1;
 133   1          
 134   1        key_value = Key_Scan(); //ï¿?1ï¿?7ï¿?1ï¿?7ï¿?0ï¿?0ï¿?1ï¿?7ï¿?1ï¿?7ï¿?0ï¿?5 ï¿?0ï¿?6ï¿?1ï¿?7ï¿?1ï¿?7ï¿?1ï¿
             -?7ï¿?1ï¿?7ï¿?1ï¿?7ï¿?1ï¿?7
 135   1        key_down = key_value & (key_value ^ key_old); //ï¿?1ï¿?7ï¿?0ï¿?5ï¿?1ï¿?7ï¿?1ï¿?7ï¿?1ï¿?7
 136   1        key_up = ~key_value & (key_value ^ key_old);  //ï¿?1ï¿?7ï¿?1ï¿?7ï¿?1ï¿?7ï¿?1ï¿?7ï¿?1ï¿?7ï¿?1ï¿?7
 137   1        key_old = key_value;
 138   1        
 139   1        if(key_down)       //ï¿?1ï¿?7ï¿?1ï¿?7ï¿?1ï¿?7ï¿?1ï¿?73ï¿?1ï¿?7ï¿?1ï¿?7
 140   1          key_tick = 3000;
 141   1        
 142   1         //key_oldï¿?1ï¿?7ï¿?1ï¿?7ï¿?0ï¿?5 tickï¿?1ï¿?7ï¿?1ï¿?7ï¿?1ï¿?7ï¿?0ï¿?4ï¿?1ï¿?7ï¿?1ï¿?7ï¿?1ï¿?7  longï¿?1
             -ï¿?7ï¿?1ï¿?7ï¿?1ï¿?7ï¿?1ï¿?7ï¿?1ï¿?7ï¿?1ï¿?7ï¿?1ï¿?7ï¿?1ï¿?7ï¿?0ï¿?8ï¿?1ï¿?7ï¿?1ï¿?7ï¿?1ï¿?7ï¿?1ï¿?7ï¿?1ï¿?7ï¿?1ï¿?7ï¿?1
             -ï¿?7ï¿?1ï¿?7ï¿?0ï¿?1ï¿?1ï¿?7ï¿?1ï¿?7ï¿?1ï¿?7ï¿?1ï¿?7ï¿?0ï¿?5ï¿?1ï¿?7ï¿?1ï¿?7
 143   1        if(key_old && key_tick == 0 && keylong){
 144   2          keylong = 0;    
 145   2          if(key_old == 1){     //ï¿?1ï¿?7ï¿?1ï¿?7ï¿?1ï¿?7ï¿?1ï¿?7ï¿?0ï¿?7ï¿?1ï¿?7ï¿?1ï¿?7ï¿?1ï¿?7ï¿?1ï¿?7    
 146   3            //------ï¿?1ï¿?7ï¿?1ï¿?7ï¿?1ï¿?7ï¿?1ï¿?71ï¿?1ï¿?7ï¿?1ï¿?7ï¿?1ï¿?7ï¿?1ï¿?7ï¿?1ï¿?7ï¿?1ï¿?7ï¿?1ï¿?7ï¿?1ï¿
             -?7--------
 147   3            
 148   3            //------ï¿?1ï¿?7ï¿?1ï¿?7ï¿?1ï¿?7ï¿?1ï¿?71ï¿?1ï¿?7ï¿?1ï¿?7ï¿?1ï¿?7ï¿?1ï¿?7ï¿?1ï¿?7ï¿?1ï¿?7ï¿?1ï¿?7ï¿?1ï¿
             -?7--------        
 149   3          }
C51 COMPILER V9.57.0.0   MAIN                                                              10/02/2024 10:01:27 PAGE 4   

 150   2          if(key_old == 4){ //ï¿?1ï¿?7ï¿?1ï¿?7ï¿?1ï¿?7ï¿?1ï¿?7ï¿?1ï¿?7ï¿?0ï¿?3ï¿?1ï¿?7ï¿?1ï¿?7ï¿?1ï¿?7  
 151   3            //------ï¿?1ï¿?7ï¿?1ï¿?7ï¿?1ï¿?7ï¿?1ï¿?74ï¿?1ï¿?7ï¿?1ï¿?7ï¿?1ï¿?7ï¿?1ï¿?7ï¿?1ï¿?7ï¿?1ï¿?7ï¿?1ï¿?7ï¿?1ï¿
             -?7--------
 152   3      
 153   3            //------ï¿?1ï¿?7ï¿?1ï¿?7ï¿?1ï¿?7ï¿?1ï¿?74ï¿?1ï¿?7ï¿?1ï¿?7ï¿?1ï¿?7ï¿?1ï¿?7ï¿?1ï¿?7ï¿?1ï¿?7ï¿?1ï¿?7ï¿?1ï¿
             -?7--------    
 154   3          }
 155   2        }
 156   1        
 157   1        if(key_up) //keydown-keyupï¿?0ï¿?3ï¿?1ï¿?7ï¿?1ï¿?7ï¿?1ï¿?7ï¿?1ï¿?2ï¿?1ï¿?7ï¿?1ï¿?7ï¿?1ï¿?7
 158   1          keylong = 1;
 159   1        
 160   1        if(key_tick && key_sw){
 161   2          switch(key_up)
 162   2          {
 163   3            case 1://ï¿?1ï¿?7ï¿?1ï¿?7ï¿?1ï¿?7ï¿?1ï¿?71
 164   3            {     
 165   4              if(++mode > 3) mode = 0;
 166   4              break;
 167   4            }
 168   3            case 2://ï¿?1ï¿?7ï¿?1ï¿?7ï¿?1ï¿?7ï¿?1ï¿?72
 169   3            {
 170   4              if(--mode == 0) mode = 0;
 171   4              break;
 172   4            }
 173   3            case 3://ï¿?1ï¿?7ï¿?1ï¿?7ï¿?1ï¿?7ï¿?1ï¿?73
 174   3            {
 175   4              Buzzer ^= 1;
 176   4              break;
 177   4            }
 178   3            case 4://ï¿?1ï¿?7ï¿?1ï¿?7ï¿?1ï¿?7ï¿?1ï¿?74
 179   3            {  
 180   4              mode++;
 181   4              break;                             
 182   4            }                                    
 183   3            default:                             
 184   3              break;
 185   3          }
 186   2        }
 187   1          
 188   1      }
 189          
 190          //================ï¿?1ï¿?7ï¿?1ï¿?7ï¿?0ï¿?5ï¿?1ï¿?7ï¿?1ï¿?8ï¿?1ï¿?7ï¿?1ï¿?7ï¿?1ï¿?7ï¿?1ï¿?7ï¿?1ï¿?7========
             -===============
 191          void Disp_Proc(void)       //LCD Dsiplay process function
 192          {
 193   1        if(disp_slow_down) return;   //200msï¿?1ï¿?7ï¿?1ï¿?7ï¿?1ï¿?7ï¿?1ï¿?7ï¿?0ï¿?5ï¿?1ï¿?7æ±›ï¿½0ï¿?0ï¿?1ï¿?7ï¿
             -?1ï¿?7ï¿?1ï¿?7(200msï¿?0ï¿?6ï¿?1ï¿?7ï¿?1ï¿?7ï¿?0ï¿?5ï¿?1ï¿?7ï¿?1ï¿?7ï¿?1ï¿?7ï¿?1ï¿?7ï¿?0ï¿?3)
 194   1          disp_slow_down = 1;
 195   1        
 196   1        sprintf(seg_string,"---%d",(unsigned int)mode); //ï¿?1ï¿?7ï¿?1ï¿?7ï¿?1ï¿?7ï¿?1ï¿?7
 197   1        //sprintf(seg_string,"0001"); //ï¿?1ï¿?7ï¿?1ï¿?7ï¿?1ï¿?7ï¿?1ï¿?7
 198   1        Led_Trans(seg_string,seg_buf1); 
 199   1      
 200   1        sprintf(seg_string,"----");
 201   1        Led_Trans(seg_string,seg_buf2); 
 202   1        
 203   1      }
 204          
 205          //================ï¿?1ï¿?7ï¿?0ï¿?8ï¿?1ï¿?7ï¿?1ï¿?7ð ¬ï¿?1ï¿?7ï¿?1ï¿?7=======================
 206          
 207          //ï¿?1ï¿?7ï¿?1ï¿?7ï¿?0ï¿?2ï¿?1ï¿?7ï¿?1ï¿?7ï¿?1ï¿?7ï¿?1ï¿?7ï¿?0ï¿?2 ï¿?1ï¿?7ï¿?6ï¿?2ï¿?0ï¿?9ï¿?1ï¿?7ï¿?1ï¿?
C51 COMPILER V9.57.0.0   MAIN                                                              10/02/2024 10:01:27 PAGE 5   

             -7ï¿?0ï¿?2ï¿?1ï¿?7ï¿?1ï¿?7ï¿?1ï¿?7ï¿?1ï¿?7ï¿?1ï¿?7ï¿?1ï¿?7ï¿?1ï¿?7ï¿?1ï¿?7ï¿?1ï¿?7ï¿?1ï¿?7ï¿?1ï¿?7ï¿?1ï¿?7ï¿?0ï¿?8ï¿?1ï¿?
             -7ï¿?1ï¿?7ï¿?1ï¿?7ï¿?1ï¿?7ï¿?1ï¿?7ï¿?1ï¿?7ï¿?1ï¿?7ï¿?1ï¿?7ï¿?1ï¿?7ï¿?1ï¿?7
 208          void Delay(unsigned int delay) 
 209          {
 210   1        delay_tick = delay;
 211   1        while(delay_tick > 0);
 212   1      }
 213          
 214          /*
 215          tick: ï¿?1ï¿?7ï¿?1ï¿?7ï¿?1ï¿?7ï¿?1ï¿?7ï¿?1ï¿?7ï¿?1ï¿?7ï¿?1ï¿?7ï¿?1ï¿?7ï¿?1ï¿?7ï¿?0ï¿?2ï¿?1ï¿?7ï¿?1ï¿?7ms
 216          */
 217          void Buzzer_Ctrl(u16 tick)  
 218          {
 219   1        buzzer_tick = tick;
 220   1      }
 221          
 222          void Peripheral_Init(void)//ï¿?1ï¿?7ï¿?1ï¿?7ï¿?1ï¿?7ï¿?1ï¿?7ï¿?1ï¿?7ï¿?0ï¿?3ï¿?1ï¿?7ï¿?1ï¿?7ï¿?1ï¿?7ï¿?1ï¿
             -?7ï¿?1ï¿?7ï¿?1ï¿?7
 223          {
 224   1        Buzzer_Ctrl(200);//ï¿?1ï¿?7ï¿?0ï¿?3ï¿?1ï¿?7ï¿?1ï¿?7ï¿?1ï¿?7ï¿?1ï¿?7200msï¿?0ï¿?5ï¿?1ï¿?7ï¿?1ï¿?7
 225   1        LED_buf = 0x30;
 226   1       
 227   1      }
 228          
 229          
 230          //================ï¿?1ï¿?7ï¿?1ï¿?7ï¿?1ï¿?7ï¿?1ï¿?72ï¿?1ï¿?7ï¿?1ï¿?7ï¿?1ï¿?7ï¿?1ï¿?4ï¿?1ï¿?7ï¿?1ï¿?7ï¿?1ï¿?
             -7=======================
 231          
 232          //========================================================================
 233          // ï¿?1ï¿?7ï¿?1ï¿?7ï¿?1ï¿?7ï¿?1ï¿?7: void PrintString2(u8 *puts)
 234          // ï¿?1ï¿?7ï¿?1ï¿?7ï¿?1ï¿?7ï¿?1ï¿?7: ï¿?1ï¿?7ï¿?1ï¿?7ï¿?1ï¿?7ï¿?1ï¿?72ï¿?1ï¿?7ï¿?1ï¿?7ï¿?1ï¿?7ï¿?1ï¿?7ï¿?1
             -ï¿?7ï¿?0ï¿?7ï¿?1ï¿?7ï¿?1ï¿?7ï¿?1ï¿?7ï¿?1ï¿?7ï¿?1ï¿?7ï¿?1ï¿?7ï¿?1ï¿?7ï¿?1ï¿?7ï¿?1ï¿?7
 235          // ï¿?1ï¿?7ï¿?1ï¿?7ï¿?1ï¿?7ï¿?1ï¿?7: puts:  ï¿?1ï¿?7ï¿?0ï¿?7ï¿?1ï¿?7ï¿?1ï¿?7ï¿?1ï¿?7ï¿?0ï¿?8ï¿?1ï¿?7ï¿?1ï¿
             -?7.
 236          // ï¿?1ï¿?7ï¿?1ï¿?7ï¿?1ï¿?7ï¿?1ï¿?7: none.
 237          // ï¿?1ï¿?7ç…?: VER1.0
 238          // ï¿?1ï¿?7ï¿?1ï¿?7ï¿?1ï¿?7ï¿?1ï¿?7: 2014-11-28
 239          // ï¿?1ï¿?7ï¿?1ï¿?7ï¿?0ï¿?0: 
 240          //========================================================================
 241          void PrintString2(unsigned char *puts)
 242          {
 243   1          for (; *puts != 0;  puts++)     //ï¿?1ï¿?7ï¿?1ï¿?7ï¿?1ï¿?7ï¿?1ï¿?7ï¿?0ï¿?5ï¿?0ï¿?9ï¿?1ï¿?7ï¿?1ï¿?70ï¿?
             -1ï¿?7ï¿?1ï¿?7ï¿?1ï¿?7ï¿?1ï¿?7
 244   1          {
 245   2              S2BUF = *puts;
 246   2              B_TX2_Busy = 1;
 247   2              while(B_TX2_Busy);
 248   2          }
 249   1      }
 250          
 251          //========================================================================
 252          // ï¿?1ï¿?7ï¿?1ï¿?7ï¿?1ï¿?7ï¿?1ï¿?7: SetTimer2Baudraye(u16 dat)
 253          // ï¿?1ï¿?7ï¿?1ï¿?7ï¿?1ï¿?7ï¿?1ï¿?7: ï¿?1ï¿?7ï¿?1ï¿?7ï¿?1ï¿?7ï¿?1ï¿?7Timer2ï¿?1ï¿?7ï¿?1ï¿?7ï¿?1ï¿?7ï¿?1ï¿?
             -7ï¿?1ï¿?7ï¿?1ï¿?7ï¿?1ï¿?7ï¿?0ï¿?8ï¿?1ï¿?7ï¿?1ï¿?7ï¿?1ï¿?7ï¿?1ï¿?7ï¿?1ï¿?7ï¿?1ï¿?7ï¿?1ï¿?7
 254          // ï¿?1ï¿?7ï¿?1ï¿?7ï¿?1ï¿?7ï¿?1ï¿?7: dat: Timer2ï¿?1ï¿?7ï¿?1ï¿?7ï¿?1ï¿?7ï¿?1ï¿?7ï¿?0ï¿?4ï¿?0ï¿?5.
 255          // ï¿?1ï¿?7ï¿?1ï¿?7ï¿?1ï¿?7ï¿?1ï¿?7: none.
 256          // ï¿?1ï¿?7ç…?: VER1.0
 257          // ï¿?1ï¿?7ï¿?1ï¿?7ï¿?1ï¿?7ï¿?1ï¿?7: 2014-11-28
 258          // ï¿?1ï¿?7ï¿?1ï¿?7ï¿?0ï¿?0: 
 259          //========================================================================
 260          void SetTimer2Baudraye(unsigned int dat)  // ï¿?0ï¿?0ï¿?1ï¿?7ï¿?1ï¿?7Timer2ï¿?1ï¿?7ï¿?1ï¿?7ï¿?1ï¿?7ï¿?1ï¿?
             -7ï¿?1ï¿?7ï¿?1ï¿?7ï¿?1ï¿?7ï¿?1ï¿?7.
C51 COMPILER V9.57.0.0   MAIN                                                              10/02/2024 10:01:27 PAGE 6   

 261          {
 262   1          AUXR &= ~(1<<4);    //Timer stop
 263   1          AUXR &= ~(1<<3);    //Timer2 set As Timer
 264   1          AUXR |=  (1<<2);    //Timer2 set as 1T mode
 265   1          T2H = dat / 256;
 266   1          T2L = dat % 256;
 267   1          IE2  &= ~(1<<2);    //ï¿?1ï¿?7ï¿?1ï¿?7ï¿?0ï¿?9ï¿?1ï¿?7å¿?ï¿?1ï¿?7
 268   1          AUXR |=  (1<<4);    //Timer run enable
 269   1      }
 270          
 271          //========================================================================
 272          // ï¿?1ï¿?7ï¿?1ï¿?7ï¿?1ï¿?7ï¿?1ï¿?7: void UART2_config(u8 brt)
 273          // ï¿?1ï¿?7ï¿?1ï¿?7ï¿?1ï¿?7ï¿?1ï¿?7: UART2ï¿?1ï¿?7ï¿?1ï¿?7ï¿?0ï¿?3ï¿?1ï¿?7ï¿?1ï¿?7ï¿?1ï¿?7ï¿?1ï¿?7ï¿?1ï¿?7
             -ï¿?1ï¿?7ï¿?1ï¿?7ï¿?1ï¿?7
 274          // ï¿?1ï¿?7ï¿?1ï¿?7ï¿?1ï¿?7ï¿?1ï¿?7: brt: ï¿?0ï¿?5ï¿?1ï¿?7ï¿?1ï¿?7ï¿?1ï¿?7ï¿?1ï¿?7ï¿?1ï¿?7ï¿?1ï¿?7, 2: ï¿?
             -0ï¿?0ï¿?1ï¿?7ï¿?1ï¿?7Timer2ï¿?1ï¿?7ï¿?1ï¿?7ï¿?1ï¿?7ï¿?1ï¿?7ï¿?1ï¿?7ï¿?1ï¿?7ï¿?1ï¿?7ï¿?1ï¿?7, ï¿?1ï¿?7ï¿?1ï¿?7ï¿?1ï¿?7ï¿?
             -1ï¿?7ï¿?0ï¿?5: ï¿?1ï¿?7ï¿?1ï¿?7å®?.
 275          // ï¿?1ï¿?7ï¿?1ï¿?7ï¿?1ï¿?7ï¿?1ï¿?7: none.
 276          // ï¿?1ï¿?7ç…?: VER1.0
 277          // ï¿?1ï¿?7ï¿?1ï¿?7ï¿?1ï¿?7ï¿?1ï¿?7: 2014-11-28
 278          // ï¿?1ï¿?7ï¿?1ï¿?7ï¿?0ï¿?0: 
 279          //========================================================================
 280          void UART2_config(unsigned char brt)    // ï¿?0ï¿?5ï¿?1ï¿?7ï¿?1ï¿?7ï¿?1ï¿?7ï¿?1ï¿?7ï¿?1ï¿?7ï¿?1ï¿?7, 2: ï¿
             -?0ï¿?0ï¿?1ï¿?7ï¿?1ï¿?7Timer2ï¿?1ï¿?7ï¿?1ï¿?7ï¿?1ï¿?7ï¿?1ï¿?7ï¿?1ï¿?7ï¿?1ï¿?7ï¿?1ï¿?7ï¿?1ï¿?7, ï¿?1ï¿?7ï¿?1ï¿?7ï¿?1ï¿?7ï¿
             -?1ï¿?7ï¿?0ï¿?5: ï¿?1ï¿?7ï¿?1ï¿?7å®?.
 281          {
 282   1          /*********** ï¿?1ï¿?7ï¿?1ï¿?7ï¿?1ï¿?7ï¿?1ï¿?7ï¿?1ï¿?7ï¿?0ï¿?0ï¿?0ï¿?0ï¿?1ï¿?7ï¿?0ï¿?0ï¿?1ï¿?7ï¿?0ï¿?2ï
             -¿?1ï¿?7ï¿?0ï¿?2ï¿?1ï¿?7ï¿?1ï¿?72 *****************/
 283   1          if(brt == 2)
 284   1          {
 285   2              SetTimer2Baudraye(65536UL - (MAIN_Fosc / 4) / Baudrate2);
 286   2      
 287   2              S2CON &= ~(1<<7);   // 8ç«¹ï¿½1ï¿?7ï¿?1ï¿?7ï¿?1ï¿?7ï¿?1ï¿?7, 1ç«¹ï¿½1ï¿?7ï¿?1ï¿?7ï¿?0ï¿?3ç«?, 1ç«¹
             -ï¿½0ï¿?5ï¿?0ï¿?9ç«?, ï¿?1ï¿?7ï¿?1ï¿?7å­ï¿½1ï¿?7ï¿?1ï¿?7
 288   2              IE2   |= 1;         //ï¿?1ï¿?7ï¿?1ï¿?7ï¿?1ï¿?7ï¿?1ï¿?7ï¿?1ï¿?7å¿?ï¿?1ï¿?7
 289   2              S2CON |= (1<<4);    //ï¿?1ï¿?7ï¿?1ï¿?7ï¿?1ï¿?7ï¿?1ï¿?7ï¿?1ï¿?7ï¿?1ï¿?7ï¿?1ï¿?7ï¿?1ï¿?7
 290   2              P_SW2 &= ~0x01; 
 291   2              P_SW2 |= 0;         //UART2 switch to: 0: P1.0 P1.1,  1: P4.6 P4.7
 292   2      
 293   2              B_TX2_Busy = 0;
 294   2              TX2_Cnt = 0;
 295   2              RX2_Cnt = 0;
 296   2          }
 297   1      }
 298          
 299          //========================================================================
 300          // ï¿?1ï¿?7ï¿?1ï¿?7ï¿?1ï¿?7ï¿?1ï¿?7: void UART2_int (void) interrupt UART2_VECTOR
 301          // ï¿?1ï¿?7ï¿?1ï¿?7ï¿?1ï¿?7ï¿?1ï¿?7: UART2ï¿?1ï¿?7å¿?ï¿?0ï¿?8ï¿?1ï¿?7ï¿?1ï¿?7ï¿?1ï¿?7ï¿?1ï¿?7ï¿?1ï¿?7
 302          // ï¿?1ï¿?7ï¿?1ï¿?7ï¿?1ï¿?7ï¿?1ï¿?7: nine.
 303          // ï¿?1ï¿?7ï¿?1ï¿?7ï¿?1ï¿?7ï¿?1ï¿?7: none.
 304          // ï¿?1ï¿?7ç…?: VER1.0
 305          // ï¿?1ï¿?7ï¿?1ï¿?7ï¿?1ï¿?7ï¿?1ï¿?7: 2014-11-28
 306          // ï¿?1ï¿?7ï¿?1ï¿?7ï¿?0ï¿?0: 
 307          //========================================================================
 308          void UART2_int (void) interrupt 8
 309          {
 310   1          if((S2CON & 1) != 0)
 311   1          {
 312   2              S2CON &= ~1;    //Clear Rx flag
 313   2              RX2_Buffer[RX2_Cnt] = S2BUF;
 314   2              if(++RX2_Cnt >= UART2_BUF_LENGTH)   RX2_Cnt = 0;
 315   2          }
C51 COMPILER V9.57.0.0   MAIN                                                              10/02/2024 10:01:27 PAGE 7   

 316   1      
 317   1          if((S2CON & 2) != 0)
 318   1          {
 319   2              S2CON &= ~2;    //Clear Tx flag
 320   2              B_TX2_Busy = 0;
 321   2          }
 322   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    620    ----
   CONSTANT SIZE    =     46    ----
   XDATA SIZE       =     64    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =     31    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =      3    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
